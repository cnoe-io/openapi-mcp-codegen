# Copyright 2025 CNOE
# SPDX-License-Identifier: Apache-2.0
# Generated by CNOE OpenAPI MCP Codegen tool

"""Tools for /api/v1/applications/{application.metadata.name} operations"""

import logging
from typing import Dict, Any, List
from mcp_argocd.api.client import make_api_request, assemble_nested_body

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("mcp_tools")


async def put_application_svc_upd(
  path_application_metadata_name: str,
  body_metadata: Dict[str, Any] = None,
  body_operation_info: List[Dict[str, Any]] = None,
  body_operation_initiated_by_automated: bool = None,
  body_operation_initiated_by_username: str = None,
  body_operation_retry_backoff_duration: str = None,
  body_operation_retry_backoff_factor: int = None,
  body_operation_retry_backoff_max_duration: str = None,
  body_operation_retry_limit: int = None,
  body_operation_retry_refresh: bool = None,
  body_operation_sync: Dict[str, Any] = None,
  body_spec_destination_name: str = None,
  body_spec_destination_namespace: str = None,
  body_spec_destination_server: str = None,
  body_spec_ignore_differences: List[Dict[str, Any]] = None,
  body_spec_info: List[Dict[str, Any]] = None,
  body_spec_project: str = None,
  body_spec_revision_history_limit: int = None,
  body_spec_source_chart: str = None,
  body_spec_source_directory_exclude: str = None,
  body_spec_source_directory_include: str = None,
  body_spec_source_directory_jsonnet_ext_vars: List[Dict[str, Any]] = None,
  body_spec_source_directory_jsonnet_libs: List[str] = None,
  body_spec_source_directory_jsonnet_tlas: List[Dict[str, Any]] = None,
  body_spec_source_directory_recurse: bool = None,
  body_spec_source_helm: Dict[str, Any] = None,
  body_spec_source_kustomize: Dict[str, Any] = None,
  body_spec_source_name: str = None,
  body_spec_source_path: str = None,
  body_spec_source_plugin_env: List[Dict[str, Any]] = None,
  body_spec_source_plugin_name: str = None,
  body_spec_source_plugin_parameters: List[Dict[str, Any]] = None,
  body_spec_source_ref: str = None,
  body_spec_source_repo_url: str = None,
  body_spec_source_target_revision: str = None,
  body_spec_source_hydrator_dry_source_path: str = None,
  body_spec_source_hydrator_dry_source_repo_url: str = None,
  body_spec_source_hydrator_dry_source_target_revision: str = None,
  body_spec_source_hydrator_hydrate_to_target_branch: str = None,
  body_spec_source_hydrator_sync_source_path: str = None,
  body_spec_source_hydrator_sync_source_target_branch: str = None,
  body_spec_sources: List[Dict[str, Any]] = None,
  body_spec_sync_policy_automated_allow_empty: bool = None,
  body_spec_sync_policy_automated_enabled: bool = None,
  body_spec_sync_policy_automated_prune: bool = None,
  body_spec_sync_policy_automated_self_heal: bool = None,
  body_spec_sync_policy_managed_namespace_metadata_annotations: Dict[str, Any] = None,
  body_spec_sync_policy_managed_namespace_metadata_labels: Dict[str, Any] = None,
  body_spec_sync_policy_retry_backoff_duration: str = None,
  body_spec_sync_policy_retry_backoff_factor: int = None,
  body_spec_sync_policy_retry_backoff_max_duration: str = None,
  body_spec_sync_policy_retry_limit: int = None,
  body_spec_sync_policy_retry_refresh: bool = None,
  body_spec_sync_policy_sync_options: List[str] = None,
  body_status: Dict[str, Any] = None,
  param_validate: bool = False,
  param_project: str = None,
) -> Any:
  """
      Update updates an application

      OpenAPI Description:


      Args:

          path_application_metadata_name (str): Name must be unique within a namespace. Is required when creating resources, although
  some resources may allow a client to request the generation of an appropriate name
  automatically. Name is primarily intended for creation idempotence and configuration
  definition.
  Cannot be updated.
  More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names#names
  +optional

          body_metadata (Dict[str, Any]): ObjectMeta is metadata that all persisted resources must have, which includes all objects
  users must create.

          body_operation_info (List[Dict[str, Any]]): OpenAPI parameter corresponding to 'body_operation_info'

          body_operation_initiated_by_automated (bool): Automated is set to true if operation was initiated automatically by the application controller.

          body_operation_initiated_by_username (str): OpenAPI parameter corresponding to 'body_operation_initiated_by_username'

          body_operation_retry_backoff_duration (str): OpenAPI parameter corresponding to 'body_operation_retry_backoff_duration'

          body_operation_retry_backoff_factor (int): OpenAPI parameter corresponding to 'body_operation_retry_backoff_factor'

          body_operation_retry_backoff_max_duration (str): OpenAPI parameter corresponding to 'body_operation_retry_backoff_max_duration'

          body_operation_retry_limit (int): Limit is the maximum number of attempts for retrying a failed sync. If set to 0, no retries will be performed.

          body_operation_retry_refresh (bool): OpenAPI parameter corresponding to 'body_operation_retry_refresh'

          body_operation_sync (Dict[str, Any]): SyncOperation contains details about a sync operation.

          body_spec_destination_name (str): Name is an alternate way of specifying the target cluster by its symbolic name. This must be set if Server is not set.

          body_spec_destination_namespace (str): OpenAPI parameter corresponding to 'body_spec_destination_namespace'

          body_spec_destination_server (str): Server specifies the URL of the target cluster's Kubernetes control plane API. This must be set if Name is not set.

          body_spec_ignore_differences (List[Dict[str, Any]]): OpenAPI parameter corresponding to 'body_spec_ignore_differences'

          body_spec_info (List[Dict[str, Any]]): OpenAPI parameter corresponding to 'body_spec_info'

          body_spec_project (str): Project is a reference to the project this application belongs to.
  The empty string means that application belongs to the 'default' project.

          body_spec_revision_history_limit (int): RevisionHistoryLimit limits the number of items kept in the application's revision history, which is used for informational purposes as well as for rollbacks to previous versions.
  This should only be changed in exceptional circumstances.
  Setting to zero will store no history. This will reduce storage used.
  Increasing will increase the space used to store the history, so we do not recommend increasing it.
  Default is 10.

          body_spec_source_chart (str): Chart is a Helm chart name, and must be specified for applications sourced from a Helm repo.

          body_spec_source_directory_exclude (str): OpenAPI parameter corresponding to 'body_spec_source_directory_exclude'

          body_spec_source_directory_include (str): OpenAPI parameter corresponding to 'body_spec_source_directory_include'

          body_spec_source_directory_jsonnet_ext_vars (List[Dict[str, Any]]): OpenAPI parameter corresponding to 'body_spec_source_directory_jsonnet_ext_vars'

          body_spec_source_directory_jsonnet_libs (List[str]): OpenAPI parameter corresponding to 'body_spec_source_directory_jsonnet_libs'

          body_spec_source_directory_jsonnet_tlas (List[Dict[str, Any]]): OpenAPI parameter corresponding to 'body_spec_source_directory_jsonnet_tlas'

          body_spec_source_directory_recurse (bool): OpenAPI parameter corresponding to 'body_spec_source_directory_recurse'

          body_spec_source_helm (Dict[str, Any]): Request body as dictionary. Contains 15 nested properties. See OpenAPI schema for detailed structure.

          body_spec_source_kustomize (Dict[str, Any]): Request body as dictionary. Contains 18 nested properties. See OpenAPI schema for detailed structure.

          body_spec_source_name (str): Name is used to refer to a source and is displayed in the UI. It is used in multi-source Applications.

          body_spec_source_path (str): Path is a directory path within the Git repository, and is only valid for applications sourced from Git.

          body_spec_source_plugin_env (List[Dict[str, Any]]): OpenAPI parameter corresponding to 'body_spec_source_plugin_env'

          body_spec_source_plugin_name (str): OpenAPI parameter corresponding to 'body_spec_source_plugin_name'

          body_spec_source_plugin_parameters (List[Dict[str, Any]]): OpenAPI parameter corresponding to 'body_spec_source_plugin_parameters'

          body_spec_source_ref (str): Ref is reference to another source within sources field. This field will not be used if used with a `source` tag.

          body_spec_source_repo_url (str): OpenAPI parameter corresponding to 'body_spec_source_repo_url'

          body_spec_source_target_revision (str): TargetRevision defines the revision of the source to sync the application to.
  In case of Git, this can be commit, tag, or branch. If omitted, will equal to HEAD.
  In case of Helm, this is a semver tag for the Chart's version.

          body_spec_source_hydrator_dry_source_path (str): OpenAPI parameter corresponding to 'body_spec_source_hydrator_dry_source_path'

          body_spec_source_hydrator_dry_source_repo_url (str): OpenAPI parameter corresponding to 'body_spec_source_hydrator_dry_source_repo_url'

          body_spec_source_hydrator_dry_source_target_revision (str): OpenAPI parameter corresponding to 'body_spec_source_hydrator_dry_source_target_revision'

          body_spec_source_hydrator_hydrate_to_target_branch (str): OpenAPI parameter corresponding to 'body_spec_source_hydrator_hydrate_to_target_branch'

          body_spec_source_hydrator_sync_source_path (str): Path is a directory path within the git repository where hydrated manifests should be committed to and synced
  from. The Path should never point to the root of the repo. If hydrateTo is set, this is just the path from which
  hydrated manifests will be synced.

  +kubebuilder:validation:Required
  +kubebuilder:validation:MinLength=1
  +kubebuilder:validation:Pattern=`^.{2,}|[^./]$`

          body_spec_source_hydrator_sync_source_target_branch (str): TargetBranch is the branch from which hydrated manifests will be synced.
  If HydrateTo is not set, this is also the branch to which hydrated manifests are committed.

          body_spec_sources (List[Dict[str, Any]]): OpenAPI parameter corresponding to 'body_spec_sources'

          body_spec_sync_policy_automated_allow_empty (bool): OpenAPI parameter corresponding to 'body_spec_sync_policy_automated_allow_empty'

          body_spec_sync_policy_automated_enabled (bool): OpenAPI parameter corresponding to 'body_spec_sync_policy_automated_enabled'

          body_spec_sync_policy_automated_prune (bool): OpenAPI parameter corresponding to 'body_spec_sync_policy_automated_prune'

          body_spec_sync_policy_automated_self_heal (bool): OpenAPI parameter corresponding to 'body_spec_sync_policy_automated_self_heal'

          body_spec_sync_policy_managed_namespace_metadata_annotations (Dict[str, Any]): OpenAPI parameter corresponding to 'body_spec_sync_policy_managed_namespace_metadata_annotations'

          body_spec_sync_policy_managed_namespace_metadata_labels (Dict[str, Any]): OpenAPI parameter corresponding to 'body_spec_sync_policy_managed_namespace_metadata_labels'

          body_spec_sync_policy_retry_backoff_duration (str): OpenAPI parameter corresponding to 'body_spec_sync_policy_retry_backoff_duration'

          body_spec_sync_policy_retry_backoff_factor (int): OpenAPI parameter corresponding to 'body_spec_sync_policy_retry_backoff_factor'

          body_spec_sync_policy_retry_backoff_max_duration (str): OpenAPI parameter corresponding to 'body_spec_sync_policy_retry_backoff_max_duration'

          body_spec_sync_policy_retry_limit (int): Limit is the maximum number of attempts for retrying a failed sync. If set to 0, no retries will be performed.

          body_spec_sync_policy_retry_refresh (bool): OpenAPI parameter corresponding to 'body_spec_sync_policy_retry_refresh'

          body_spec_sync_policy_sync_options (List[str]): OpenAPI parameter corresponding to 'body_spec_sync_policy_sync_options'

          body_status (Dict[str, Any]): Request body as dictionary. Contains 14 nested properties. See OpenAPI schema for detailed structure.

          param_validate (bool): OpenAPI parameter corresponding to 'param_validate'

          param_project (str): OpenAPI parameter corresponding to 'param_project'


      Returns:
          Any: The JSON response from the API call.

      Raises:
          Exception: If the API request fails or returns an error.
  """
  logger.debug("Making PUT request to /api/v1/applications/{application.metadata.name}")

  params = {}
  data = {}

  if param_validate is not None:
    params["validate"] = str(param_validate).lower() if isinstance(param_validate, bool) else param_validate

  if param_project is not None:
    params["project"] = str(param_project).lower() if isinstance(param_project, bool) else param_project

  flat_body = {}
  if body_metadata is not None:
    flat_body["metadata"] = body_metadata
  if body_operation_info is not None:
    flat_body["operation_info"] = body_operation_info
  if body_operation_initiated_by_automated is not None:
    flat_body["operation_initiated_by_automated"] = body_operation_initiated_by_automated
  if body_operation_initiated_by_username is not None:
    flat_body["operation_initiated_by_username"] = body_operation_initiated_by_username
  if body_operation_retry_backoff_duration is not None:
    flat_body["operation_retry_backoff_duration"] = body_operation_retry_backoff_duration
  if body_operation_retry_backoff_factor is not None:
    flat_body["operation_retry_backoff_factor"] = body_operation_retry_backoff_factor
  if body_operation_retry_backoff_max_duration is not None:
    flat_body["operation_retry_backoff_max_duration"] = body_operation_retry_backoff_max_duration
  if body_operation_retry_limit is not None:
    flat_body["operation_retry_limit"] = body_operation_retry_limit
  if body_operation_retry_refresh is not None:
    flat_body["operation_retry_refresh"] = body_operation_retry_refresh
  if body_operation_sync is not None:
    flat_body["operation_sync"] = body_operation_sync
  if body_spec_destination_name is not None:
    flat_body["spec_destination_name"] = body_spec_destination_name
  if body_spec_destination_namespace is not None:
    flat_body["spec_destination_namespace"] = body_spec_destination_namespace
  if body_spec_destination_server is not None:
    flat_body["spec_destination_server"] = body_spec_destination_server
  if body_spec_ignore_differences is not None:
    flat_body["spec_ignore_differences"] = body_spec_ignore_differences
  if body_spec_info is not None:
    flat_body["spec_info"] = body_spec_info
  if body_spec_project is not None:
    flat_body["spec_project"] = body_spec_project
  if body_spec_revision_history_limit is not None:
    flat_body["spec_revision_history_limit"] = body_spec_revision_history_limit
  if body_spec_source_chart is not None:
    flat_body["spec_source_chart"] = body_spec_source_chart
  if body_spec_source_directory_exclude is not None:
    flat_body["spec_source_directory_exclude"] = body_spec_source_directory_exclude
  if body_spec_source_directory_include is not None:
    flat_body["spec_source_directory_include"] = body_spec_source_directory_include
  if body_spec_source_directory_jsonnet_ext_vars is not None:
    flat_body["spec_source_directory_jsonnet_ext_vars"] = body_spec_source_directory_jsonnet_ext_vars
  if body_spec_source_directory_jsonnet_libs is not None:
    flat_body["spec_source_directory_jsonnet_libs"] = body_spec_source_directory_jsonnet_libs
  if body_spec_source_directory_jsonnet_tlas is not None:
    flat_body["spec_source_directory_jsonnet_tlas"] = body_spec_source_directory_jsonnet_tlas
  if body_spec_source_directory_recurse is not None:
    flat_body["spec_source_directory_recurse"] = body_spec_source_directory_recurse
  if body_spec_source_helm is not None:
    flat_body["spec_source_helm"] = body_spec_source_helm
  if body_spec_source_kustomize is not None:
    flat_body["spec_source_kustomize"] = body_spec_source_kustomize
  if body_spec_source_name is not None:
    flat_body["spec_source_name"] = body_spec_source_name
  if body_spec_source_path is not None:
    flat_body["spec_source_path"] = body_spec_source_path
  if body_spec_source_plugin_env is not None:
    flat_body["spec_source_plugin_env"] = body_spec_source_plugin_env
  if body_spec_source_plugin_name is not None:
    flat_body["spec_source_plugin_name"] = body_spec_source_plugin_name
  if body_spec_source_plugin_parameters is not None:
    flat_body["spec_source_plugin_parameters"] = body_spec_source_plugin_parameters
  if body_spec_source_ref is not None:
    flat_body["spec_source_ref"] = body_spec_source_ref
  if body_spec_source_repo_url is not None:
    flat_body["spec_source_repo_url"] = body_spec_source_repo_url
  if body_spec_source_target_revision is not None:
    flat_body["spec_source_target_revision"] = body_spec_source_target_revision
  if body_spec_source_hydrator_dry_source_path is not None:
    flat_body["spec_source_hydrator_dry_source_path"] = body_spec_source_hydrator_dry_source_path
  if body_spec_source_hydrator_dry_source_repo_url is not None:
    flat_body["spec_source_hydrator_dry_source_repo_url"] = body_spec_source_hydrator_dry_source_repo_url
  if body_spec_source_hydrator_dry_source_target_revision is not None:
    flat_body["spec_source_hydrator_dry_source_target_revision"] = body_spec_source_hydrator_dry_source_target_revision
  if body_spec_source_hydrator_hydrate_to_target_branch is not None:
    flat_body["spec_source_hydrator_hydrate_to_target_branch"] = body_spec_source_hydrator_hydrate_to_target_branch
  if body_spec_source_hydrator_sync_source_path is not None:
    flat_body["spec_source_hydrator_sync_source_path"] = body_spec_source_hydrator_sync_source_path
  if body_spec_source_hydrator_sync_source_target_branch is not None:
    flat_body["spec_source_hydrator_sync_source_target_branch"] = body_spec_source_hydrator_sync_source_target_branch
  if body_spec_sources is not None:
    flat_body["spec_sources"] = body_spec_sources
  if body_spec_sync_policy_automated_allow_empty is not None:
    flat_body["spec_sync_policy_automated_allow_empty"] = body_spec_sync_policy_automated_allow_empty
  if body_spec_sync_policy_automated_enabled is not None:
    flat_body["spec_sync_policy_automated_enabled"] = body_spec_sync_policy_automated_enabled
  if body_spec_sync_policy_automated_prune is not None:
    flat_body["spec_sync_policy_automated_prune"] = body_spec_sync_policy_automated_prune
  if body_spec_sync_policy_automated_self_heal is not None:
    flat_body["spec_sync_policy_automated_self_heal"] = body_spec_sync_policy_automated_self_heal
  if body_spec_sync_policy_managed_namespace_metadata_annotations is not None:
    flat_body["spec_sync_policy_managed_namespace_metadata_annotations"] = body_spec_sync_policy_managed_namespace_metadata_annotations
  if body_spec_sync_policy_managed_namespace_metadata_labels is not None:
    flat_body["spec_sync_policy_managed_namespace_metadata_labels"] = body_spec_sync_policy_managed_namespace_metadata_labels
  if body_spec_sync_policy_retry_backoff_duration is not None:
    flat_body["spec_sync_policy_retry_backoff_duration"] = body_spec_sync_policy_retry_backoff_duration
  if body_spec_sync_policy_retry_backoff_factor is not None:
    flat_body["spec_sync_policy_retry_backoff_factor"] = body_spec_sync_policy_retry_backoff_factor
  if body_spec_sync_policy_retry_backoff_max_duration is not None:
    flat_body["spec_sync_policy_retry_backoff_max_duration"] = body_spec_sync_policy_retry_backoff_max_duration
  if body_spec_sync_policy_retry_limit is not None:
    flat_body["spec_sync_policy_retry_limit"] = body_spec_sync_policy_retry_limit
  if body_spec_sync_policy_retry_refresh is not None:
    flat_body["spec_sync_policy_retry_refresh"] = body_spec_sync_policy_retry_refresh
  if body_spec_sync_policy_sync_options is not None:
    flat_body["spec_sync_policy_sync_options"] = body_spec_sync_policy_sync_options
  if body_status is not None:
    flat_body["status"] = body_status
  data = assemble_nested_body(flat_body)

  success, response = await make_api_request(
    f"/api/v1/applications/{path_application_metadata_name}", method="PUT", params=params, data=data
  )

  if not success:
    logger.error(f"Request failed: {response.get('error')}")
    return {"error": response.get("error", "Request failed")}
  return response
