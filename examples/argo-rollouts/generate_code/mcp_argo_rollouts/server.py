# Copyright 2025 CNOE
# SPDX-License-Identifier: Apache-2.0
# Generated by CNOE OpenAPI MCP Codegen tool

#!/usr/bin/env python3
"""
 MCP Server

This server provides a Model Context Protocol (MCP) interface to the ,
allowing large language models and AI assistants to interact with the service.
"""

import logging
import os
from dotenv import load_dotenv
from fastmcp import FastMCP


from mcp_argo_rollouts.tools import api_v1_namespace

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_info

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_info_watch

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_name_abort

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_name_info

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_name_info_watch

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_name_promote

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_name_restart

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_name_retry

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_rollout_set_container_image_tag

from mcp_argo_rollouts.tools import api_v1_rollouts_namespace_rollout_undo_revision

from mcp_argo_rollouts.tools import api_v1_version


def main():
    # Load environment variables
    load_dotenv()

    # Configure logging
    logging.basicConfig(level=logging.INFO)

    # Get MCP configuration from environment variables
    MCP_MODE = os.getenv("MCP_MODE", "stdio").lower()

    # Get host and port for server
    MCP_HOST = os.getenv("MCP_HOST", "localhost")
    MCP_PORT = int(os.getenv("MCP_PORT", "8000"))

    logging.info(f"Starting MCP server in {MCP_MODE} mode on {MCP_HOST}:{MCP_PORT}")

    # Get agent name from environment variables
    SERVER_NAME = os.getenv("SERVER_NAME") or os.getenv("AGENT_NAME") or "ARGO_ROLLOUTS"
    logging.info(f"MCP Server name: {SERVER_NAME}")

    # Create server instance
    if MCP_MODE.lower() in ["sse", "http"]:
        mcp = FastMCP(f"{SERVER_NAME} MCP Server", host=MCP_HOST, port=MCP_PORT)
    else:
        mcp = FastMCP(f"{SERVER_NAME} MCP Server")

    # Register api_v1_namespace tools

    mcp.tool()(api_v1_namespace.get_rollout_svc_get_ns)

    # Register api_v1_rollouts_namespace_info tools

    mcp.tool()(api_v1_rollouts_namespace_info.get_rollout_svc_ls_rollout_infos)

    # Register api_v1_rollouts_namespace_info_watch tools

    mcp.tool()(api_v1_rollouts_namespace_info_watch.get_rollout_svc_infos)

    # Register api_v1_rollouts_namespace_name_abort tools

    mcp.tool()(api_v1_rollouts_namespace_name_abort.put_rollout_svc_abort_rollout)

    # Register api_v1_rollouts_namespace_name_info tools

    mcp.tool()(api_v1_rollouts_namespace_name_info.get_rollout_svc_get_rollout_info)

    # Register api_v1_rollouts_namespace_name_info_watch tools

    mcp.tool()(api_v1_rollouts_namespace_name_info_watch.get_rollout_svc_watch_rollout_info)

    # Register api_v1_rollouts_namespace_name_promote tools

    mcp.tool()(api_v1_rollouts_namespace_name_promote.put_rollout_svc_promote_rollout)

    # Register api_v1_rollouts_namespace_name_restart tools

    mcp.tool()(api_v1_rollouts_namespace_name_restart.put_rollout_svc_restart_rollout)

    # Register api_v1_rollouts_namespace_name_retry tools

    mcp.tool()(api_v1_rollouts_namespace_name_retry.put_rollout_svc_retry_rollout)

    # Register api_v1_rollouts_namespace_rollout_set_container_image_tag tools

    mcp.tool()(api_v1_rollouts_namespace_rollout_set_container_image_tag.put_rollout_svc_set_rollout_image)

    # Register api_v1_rollouts_namespace_rollout_undo_revision tools

    mcp.tool()(api_v1_rollouts_namespace_rollout_undo_revision.put_rollout_svc_undo_rollout)

    # Register api_v1_version tools

    mcp.tool()(api_v1_version.get_rollout_svc_version)

    # Run the MCP server
    mcp.run(transport=MCP_MODE.lower())


if __name__ == "__main__":
    main()
