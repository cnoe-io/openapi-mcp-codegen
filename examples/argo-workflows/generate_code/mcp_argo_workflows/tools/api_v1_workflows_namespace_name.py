# Copyright 2025 CNOE
# SPDX-License-Identifier: Apache-2.0
# Generated by CNOE OpenAPI MCP Codegen tool

"""Tools for /api/v1/workflows/{namespace}/{name} operations"""

import logging
from typing import Any, List
from mcp_argo_workflows.api.client import make_api_request, assemble_nested_body

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("mcp_tools")


async def get_wf_svc_get_wf(
  path_namespace: str, path_name: str, param_get_options_resource_version: str = None, param_fields: str = None
) -> Any:
  """


      OpenAPI Description:


      Args:

          path_namespace (str): OpenAPI parameter corresponding to 'path_namespace'

          path_name (str): OpenAPI parameter corresponding to 'path_name'

          param_get_options_resource_version (str): resourceVersion sets a constraint on what resource versions a request may be served from.
  See https://kubernetes.io/docs/reference/using-api/api-concepts/#resource-versions for
  details.

  Defaults to unset
  +optional

          param_fields (str): Fields to be included or excluded in the response. e.g. "spec,status.phase", "-status.nodes".


      Returns:
          Any: The JSON response from the API call.

      Raises:
          Exception: If the API request fails or returns an error.
  """
  logger.debug("Making GET request to /api/v1/workflows/{namespace}/{name}")

  params = {}
  data = {}

  if param_get_options_resource_version is not None:
    params["get_options_resource_version"] = (
      str(param_get_options_resource_version).lower()
      if isinstance(param_get_options_resource_version, bool)
      else param_get_options_resource_version
    )

  if param_fields is not None:
    params["fields"] = str(param_fields).lower() if isinstance(param_fields, bool) else param_fields

  flat_body = {}
  data = assemble_nested_body(flat_body)

  success, response = await make_api_request(f"/api/v1/workflows/{path_namespace}/{path_name}", method="GET", params=params, data=data)

  if not success:
    logger.error(f"Request failed: {response.get('error')}")
    return {"error": response.get("error", "Request failed")}
  return response


async def del_wf_svc_del_wf(
  path_namespace: str,
  path_name: str,
  param_delete_options_grace_period_seconds: str = None,
  param_delete_options_preconditions_uid: str = None,
  param_delete_options_preconditions_resource_version: str = None,
  param_delete_options_orphan_dependents: bool = False,
  param_delete_options_propagation_policy: str = None,
  param_delete_options_dry_run: List[str] = None,
  param_delete_options_ignore_store_read_error_with_cluster_breaking_potential: bool = False,
  param_force: bool = False,
) -> Any:
  """


      OpenAPI Description:


      Args:

          path_namespace (str): OpenAPI parameter corresponding to 'path_namespace'

          path_name (str): OpenAPI parameter corresponding to 'path_name'

          param_delete_options_grace_period_seconds (str): The duration in seconds before the object should be deleted. Value must be non-negative integer.
  The value zero indicates delete immediately. If this value is nil, the default grace period for the
  specified type will be used.
  Defaults to a per object value if not specified. zero means delete immediately.
  +optional.

          param_delete_options_preconditions_uid (str): Specifies the target UID.
  +optional.

          param_delete_options_preconditions_resource_version (str): Specifies the target ResourceVersion
  +optional.

          param_delete_options_orphan_dependents (bool): Deprecated: please use the PropagationPolicy, this field will be deprecated in 1.7.
  Should the dependent objects be orphaned. If true/false, the "orphan"
  finalizer will be added to/removed from the object's finalizers list.
  Either this field or PropagationPolicy may be set, but not both.
  +optional.

          param_delete_options_propagation_policy (str): Whether and how garbage collection will be performed.
  Either this field or OrphanDependents may be set, but not both.
  The default policy is decided by the existing finalizer set in the
  metadata.finalizers and the resource-specific default policy.
  Acceptable values are: 'Orphan' - orphan the dependents; 'Background' -
  allow the garbage collector to delete the dependents in the background;
  'Foreground' - a cascading policy that deletes all dependents in the
  foreground.
  +optional.

          param_delete_options_dry_run (List[str]): When present, indicates that modifications should not be
  persisted. An invalid or unrecognized dryRun directive will
  result in an error response and no further processing of the
  request. Valid values are:
  - All: all dry run stages will be processed
  +optional
  +listType=atomic.

          param_delete_options_ignore_store_read_error_with_cluster_breaking_potential (bool): if set to true, it will trigger an unsafe deletion of the resource in
  case the normal deletion flow fails with a corrupt object error.
  A resource is considered corrupt if it can not be retrieved from
  the underlying storage successfully because of a) its data can
  not be transformed e.g. decryption failure, or b) it fails
  to decode into an object.
  NOTE: unsafe deletion ignores finalizer constraints, skips
  precondition checks, and removes the object from the storage.
  WARNING: This may potentially break the cluster if the workload
  associated with the resource being unsafe-deleted relies on normal
  deletion flow. Use only if you REALLY know what you are doing.
  The default value is false, and the user must opt in to enable it
  +optional.

          param_force (bool): OpenAPI parameter corresponding to 'param_force'


      Returns:
          Any: The JSON response from the API call.

      Raises:
          Exception: If the API request fails or returns an error.
  """
  logger.debug("Making DELETE request to /api/v1/workflows/{namespace}/{name}")

  params = {}
  data = {}

  if param_delete_options_grace_period_seconds is not None:
    params["delete_options_grace_period_seconds"] = (
      str(param_delete_options_grace_period_seconds).lower()
      if isinstance(param_delete_options_grace_period_seconds, bool)
      else param_delete_options_grace_period_seconds
    )

  if param_delete_options_preconditions_uid is not None:
    params["delete_options_preconditions_uid"] = (
      str(param_delete_options_preconditions_uid).lower()
      if isinstance(param_delete_options_preconditions_uid, bool)
      else param_delete_options_preconditions_uid
    )

  if param_delete_options_preconditions_resource_version is not None:
    params["delete_options_preconditions_resource_version"] = (
      str(param_delete_options_preconditions_resource_version).lower()
      if isinstance(param_delete_options_preconditions_resource_version, bool)
      else param_delete_options_preconditions_resource_version
    )

  if param_delete_options_orphan_dependents is not None:
    params["delete_options_orphan_dependents"] = (
      str(param_delete_options_orphan_dependents).lower()
      if isinstance(param_delete_options_orphan_dependents, bool)
      else param_delete_options_orphan_dependents
    )

  if param_delete_options_propagation_policy is not None:
    params["delete_options_propagation_policy"] = (
      str(param_delete_options_propagation_policy).lower()
      if isinstance(param_delete_options_propagation_policy, bool)
      else param_delete_options_propagation_policy
    )

  if param_delete_options_dry_run is not None:
    params["delete_options_dry_run"] = (
      str(param_delete_options_dry_run).lower() if isinstance(param_delete_options_dry_run, bool) else param_delete_options_dry_run
    )

  if param_delete_options_ignore_store_read_error_with_cluster_breaking_potential is not None:
    params["delete_options_ignore_store_read_error_with_cluster_breaking_potential"] = (
      str(param_delete_options_ignore_store_read_error_with_cluster_breaking_potential).lower()
      if isinstance(param_delete_options_ignore_store_read_error_with_cluster_breaking_potential, bool)
      else param_delete_options_ignore_store_read_error_with_cluster_breaking_potential
    )

  if param_force is not None:
    params["force"] = str(param_force).lower() if isinstance(param_force, bool) else param_force

  flat_body = {}
  data = assemble_nested_body(flat_body)

  success, response = await make_api_request(f"/api/v1/workflows/{path_namespace}/{path_name}", method="DELETE", params=params, data=data)

  if not success:
    logger.error(f"Request failed: {response.get('error')}")
    return {"error": response.get("error", "Request failed")}
  return response
