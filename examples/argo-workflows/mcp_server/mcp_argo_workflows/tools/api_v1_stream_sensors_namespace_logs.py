# Copyright 2025 CNOE
# SPDX-License-Identifier: Apache-2.0
# Generated by CNOE OpenAPI MCP Codegen tool

"""Tools for /api/v1/stream/sensors/{namespace}/logs operations"""

import logging
from typing import Any
from mcp_argo_workflows.api.client import make_api_request, assemble_nested_body

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("mcp_tools")


async def sensor_service_sensors_logs(
  path_namespace: str,
  param_name: str = None,
  param_triggerName: str = None,
  param_grep: str = None,
  param_podLogOptions_container: str = None,
  param_podLogOptions_follow: bool = False,
  param_podLogOptions_previous: bool = False,
  param_podLogOptions_sinceSeconds: int = None,
  param_podLogOptions_sinceTime_seconds: int = None,
  param_podLogOptions_sinceTime_nanos: int = None,
  param_podLogOptions_timestamps: bool = False,
  param_podLogOptions_tailLines: int = None,
  param_podLogOptions_limitBytes: int = None,
  param_podLogOptions_insecureSkipTLSVerifyBackend: bool = False,
  param_podLogOptions_stream: bool = False,
) -> Any:
  """
  Retrieve details of a specific logs

  OpenAPI Description:
      Streams sensor logs in a namespace. Use when: monitoring sensor activity, debugging issues, or analyzing specific events with filters.

  Args:

      path_namespace (str): "Kubernetes namespace to retrieve sensor logs from"

      param_name (str): Filter logs by sensor name (e.g., temperature)

      param_triggerName (str): Filter logs by specific trigger name (e.g., "sensor-start")

      param_grep (str): Filter logs by regex match in 'msg' field (e.g., error, warning)

      param_podLogOptions_container (str): Specifies container to stream logs from; use if pod has multiple containers.

      param_podLogOptions_follow (bool): Enable real-time log streaming when true (default: false)

      param_podLogOptions_previous (bool): Return logs from previous container if true; use for terminated containers.

      param_podLogOptions_sinceSeconds (int): Specifies logs from seconds ago; use for recent activity analysis.

      param_podLogOptions_sinceTime_seconds (int): Specifies log start time in seconds since Unix epoch for filtering logs.

      param_podLogOptions_sinceTime_nanos (int): Specifies nanoseconds for log start time; use for precise time filtering.

      param_podLogOptions_timestamps (bool): Add timestamps to log lines when true (default: false)

      param_podLogOptions_tailLines (int): Specifies number of log lines from end to display. Use for recent log insights.

      param_podLogOptions_limitBytes (int): Specifies max bytes to read from logs; use to limit log size.

      param_podLogOptions_insecureSkipTLSVerifyBackend (bool): Skip TLS verification for backend when true (use cautiously)

      param_podLogOptions_stream (bool): Specifies log stream type: "All", "Stdout". Use to filter container log output.


  Returns:
      Any: The JSON response from the API call.

  Raises:
      Exception: If the API request fails or returns an error.
  """
  logger.debug("Making GET request to /api/v1/stream/sensors/{namespace}/logs")

  params = {}
  data = {}

  if param_name is not None:
    params["name"] = str(param_name).lower() if isinstance(param_name, bool) else param_name

  if param_triggerName is not None:
    params["triggerName"] = str(param_triggerName).lower() if isinstance(param_triggerName, bool) else param_triggerName

  if param_grep is not None:
    params["grep"] = str(param_grep).lower() if isinstance(param_grep, bool) else param_grep

  if param_podLogOptions_container is not None:
    params["podLogOptions_container"] = (
      str(param_podLogOptions_container).lower() if isinstance(param_podLogOptions_container, bool) else param_podLogOptions_container
    )

  if param_podLogOptions_follow is not None:
    params["podLogOptions_follow"] = (
      str(param_podLogOptions_follow).lower() if isinstance(param_podLogOptions_follow, bool) else param_podLogOptions_follow
    )

  if param_podLogOptions_previous is not None:
    params["podLogOptions_previous"] = (
      str(param_podLogOptions_previous).lower() if isinstance(param_podLogOptions_previous, bool) else param_podLogOptions_previous
    )

  if param_podLogOptions_sinceSeconds is not None:
    params["podLogOptions_sinceSeconds"] = (
      str(param_podLogOptions_sinceSeconds).lower()
      if isinstance(param_podLogOptions_sinceSeconds, bool)
      else param_podLogOptions_sinceSeconds
    )

  if param_podLogOptions_sinceTime_seconds is not None:
    params["podLogOptions_sinceTime_seconds"] = (
      str(param_podLogOptions_sinceTime_seconds).lower()
      if isinstance(param_podLogOptions_sinceTime_seconds, bool)
      else param_podLogOptions_sinceTime_seconds
    )

  if param_podLogOptions_sinceTime_nanos is not None:
    params["podLogOptions_sinceTime_nanos"] = (
      str(param_podLogOptions_sinceTime_nanos).lower()
      if isinstance(param_podLogOptions_sinceTime_nanos, bool)
      else param_podLogOptions_sinceTime_nanos
    )

  if param_podLogOptions_timestamps is not None:
    params["podLogOptions_timestamps"] = (
      str(param_podLogOptions_timestamps).lower() if isinstance(param_podLogOptions_timestamps, bool) else param_podLogOptions_timestamps
    )

  if param_podLogOptions_tailLines is not None:
    params["podLogOptions_tailLines"] = (
      str(param_podLogOptions_tailLines).lower() if isinstance(param_podLogOptions_tailLines, bool) else param_podLogOptions_tailLines
    )

  if param_podLogOptions_limitBytes is not None:
    params["podLogOptions_limitBytes"] = (
      str(param_podLogOptions_limitBytes).lower() if isinstance(param_podLogOptions_limitBytes, bool) else param_podLogOptions_limitBytes
    )

  if param_podLogOptions_insecureSkipTLSVerifyBackend is not None:
    params["podLogOptions_insecureSkipTLSVerifyBackend"] = (
      str(param_podLogOptions_insecureSkipTLSVerifyBackend).lower()
      if isinstance(param_podLogOptions_insecureSkipTLSVerifyBackend, bool)
      else param_podLogOptions_insecureSkipTLSVerifyBackend
    )

  if param_podLogOptions_stream is not None:
    params["podLogOptions_stream"] = (
      str(param_podLogOptions_stream).lower() if isinstance(param_podLogOptions_stream, bool) else param_podLogOptions_stream
    )

  flat_body = {}
  data = assemble_nested_body(flat_body)

  success, response = await make_api_request(f"/api/v1/stream/sensors/{path_namespace}/logs", method="GET", params=params, data=data)

  if not success:
    logger.error(f"Request failed: {response.get('error')}")
    return {"error": response.get("error", "Request failed")}
  return response
