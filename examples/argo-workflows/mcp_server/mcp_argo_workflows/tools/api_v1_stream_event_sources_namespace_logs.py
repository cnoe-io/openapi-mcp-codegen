# Copyright 2025 CNOE
# SPDX-License-Identifier: Apache-2.0
# Generated by CNOE OpenAPI MCP Codegen tool

"""Tools for /api/v1/stream/event-sources/{namespace}/logs operations"""

import logging
from typing import Any
from mcp_argo_workflows.api.client import make_api_request, assemble_nested_body

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("mcp_tools")


async def event_source_service_event_sources_logs(
  path_namespace: str,
  param_name: str = None,
  param_eventSourceType: str = None,
  param_eventName: str = None,
  param_grep: str = None,
  param_podLogOptions_container: str = None,
  param_podLogOptions_follow: bool = False,
  param_podLogOptions_previous: bool = False,
  param_podLogOptions_sinceSeconds: int = None,
  param_podLogOptions_sinceTime_seconds: int = None,
  param_podLogOptions_sinceTime_nanos: int = None,
  param_podLogOptions_timestamps: bool = False,
  param_podLogOptions_tailLines: int = None,
  param_podLogOptions_limitBytes: int = None,
  param_podLogOptions_insecureSkipTLSVerifyBackend: bool = False,
  param_podLogOptions_stream: bool = False,
) -> Any:
  """
  Retrieve details of a specific logs

  OpenAPI Description:
      Streams logs for event sources in a namespace. Use when: monitoring event source activity or debugging issues with specific events.

  Args:

      path_namespace (str): "Kubernetes namespace to retrieve event source logs"

      param_name (str): Filter logs by event source name (optional)

      param_eventSourceType (str): Specifies event source type to filter logs (e.g., webhook)

      param_eventName (str): Filter logs by specific event name (e.g., "example") to narrow results.

      param_grep (str): Filter logs by message matching this regex pattern (e.g., error.*)

      param_podLogOptions_container (str): Specifies container to stream logs from; use if pod has multiple containers.

      param_podLogOptions_follow (bool): Stream live pod logs when true; default is false. Use for real-time monitoring.

      param_podLogOptions_previous (bool): Return logs from previous container if true; use for terminated containers.

      param_podLogOptions_sinceSeconds (int): Specifies log start time in seconds before now; use for recent logs.

      param_podLogOptions_sinceTime_seconds (int): Specify logs from this UTC time onward (format: seconds since 1970-01-01).

      param_podLogOptions_sinceTime_nanos (int): Specifies nanoseconds for log retrieval start time. Use for precise time filtering.

      param_podLogOptions_timestamps (bool): Add timestamps to log lines when true (default: false)

      param_podLogOptions_tailLines (int): Specifies number of log lines from end to display; use for recent log insights.

      param_podLogOptions_limitBytes (int): Specifies max bytes of log to retrieve; use to limit log size.

      param_podLogOptions_insecureSkipTLSVerifyBackend (bool): Skip TLS verification for backend when true (use cautiously)

      param_podLogOptions_stream (bool): Specifies log stream type: "All", "Stdout". Use to filter container log output.


  Returns:
      Any: The JSON response from the API call.

  Raises:
      Exception: If the API request fails or returns an error.
  """
  logger.debug("Making GET request to /api/v1/stream/event-sources/{namespace}/logs")

  params = {}
  data = {}

  if param_name is not None:
    params["name"] = str(param_name).lower() if isinstance(param_name, bool) else param_name

  if param_eventSourceType is not None:
    params["eventSourceType"] = str(param_eventSourceType).lower() if isinstance(param_eventSourceType, bool) else param_eventSourceType

  if param_eventName is not None:
    params["eventName"] = str(param_eventName).lower() if isinstance(param_eventName, bool) else param_eventName

  if param_grep is not None:
    params["grep"] = str(param_grep).lower() if isinstance(param_grep, bool) else param_grep

  if param_podLogOptions_container is not None:
    params["podLogOptions_container"] = (
      str(param_podLogOptions_container).lower() if isinstance(param_podLogOptions_container, bool) else param_podLogOptions_container
    )

  if param_podLogOptions_follow is not None:
    params["podLogOptions_follow"] = (
      str(param_podLogOptions_follow).lower() if isinstance(param_podLogOptions_follow, bool) else param_podLogOptions_follow
    )

  if param_podLogOptions_previous is not None:
    params["podLogOptions_previous"] = (
      str(param_podLogOptions_previous).lower() if isinstance(param_podLogOptions_previous, bool) else param_podLogOptions_previous
    )

  if param_podLogOptions_sinceSeconds is not None:
    params["podLogOptions_sinceSeconds"] = (
      str(param_podLogOptions_sinceSeconds).lower()
      if isinstance(param_podLogOptions_sinceSeconds, bool)
      else param_podLogOptions_sinceSeconds
    )

  if param_podLogOptions_sinceTime_seconds is not None:
    params["podLogOptions_sinceTime_seconds"] = (
      str(param_podLogOptions_sinceTime_seconds).lower()
      if isinstance(param_podLogOptions_sinceTime_seconds, bool)
      else param_podLogOptions_sinceTime_seconds
    )

  if param_podLogOptions_sinceTime_nanos is not None:
    params["podLogOptions_sinceTime_nanos"] = (
      str(param_podLogOptions_sinceTime_nanos).lower()
      if isinstance(param_podLogOptions_sinceTime_nanos, bool)
      else param_podLogOptions_sinceTime_nanos
    )

  if param_podLogOptions_timestamps is not None:
    params["podLogOptions_timestamps"] = (
      str(param_podLogOptions_timestamps).lower() if isinstance(param_podLogOptions_timestamps, bool) else param_podLogOptions_timestamps
    )

  if param_podLogOptions_tailLines is not None:
    params["podLogOptions_tailLines"] = (
      str(param_podLogOptions_tailLines).lower() if isinstance(param_podLogOptions_tailLines, bool) else param_podLogOptions_tailLines
    )

  if param_podLogOptions_limitBytes is not None:
    params["podLogOptions_limitBytes"] = (
      str(param_podLogOptions_limitBytes).lower() if isinstance(param_podLogOptions_limitBytes, bool) else param_podLogOptions_limitBytes
    )

  if param_podLogOptions_insecureSkipTLSVerifyBackend is not None:
    params["podLogOptions_insecureSkipTLSVerifyBackend"] = (
      str(param_podLogOptions_insecureSkipTLSVerifyBackend).lower()
      if isinstance(param_podLogOptions_insecureSkipTLSVerifyBackend, bool)
      else param_podLogOptions_insecureSkipTLSVerifyBackend
    )

  if param_podLogOptions_stream is not None:
    params["podLogOptions_stream"] = (
      str(param_podLogOptions_stream).lower() if isinstance(param_podLogOptions_stream, bool) else param_podLogOptions_stream
    )

  flat_body = {}
  data = assemble_nested_body(flat_body)

  success, response = await make_api_request(f"/api/v1/stream/event-sources/{path_namespace}/logs", method="GET", params=params, data=data)

  if not success:
    logger.error(f"Request failed: {response.get('error')}")
    return {"error": response.get("error", "Request failed")}
  return response
